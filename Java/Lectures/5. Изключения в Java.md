# Изключения в Java

## Какво е изключение

* Изключение (Exception) е събитие, което възниква по време на изпълнение и прекъсва нормалния поток на програмата.
* Java използва механизъм за прихващане и обработка чрез **try / catch / finally**.

---

## Йерархия на изключенията

![Exception hierarchy](http://javac.bg/wp-content/uploads/2015/10/exception5.jpg)

* Всички изключения са наследници на класа `Throwable`.
* `Error` – критични грешки, невъзстановими (напр. `OutOfMemoryError`). Обикновено не се прихващат.
* `Exception` – възстановими грешки, могат да бъдат обработвани.

---

## Checked vs Unchecked Exceptions

![Checked vs Unchecked](https://rollbar.com/wp-content/uploads/2021/10/types-of-exceptions-in-java-checked-unchecked.png)

| Вид           | Кога се засичат        | Класове                                           | Обработка                             |
| ------------- | ---------------------- | ------------------------------------------------- | ------------------------------------- |
| **Checked**   | По време на компилация | Наследници на `Exception`, без `RuntimeException` | Задължително `try-catch` или `throws` |
| **Unchecked** | По време на изпълнение | Наследници на `RuntimeException`                  | Обработката е по избор                |

! Няма функционална разлика – разликата е само в това кога се засичат.

---

## Ключови думи

1. `try` – код, който може да генерира изключение
2. `catch` – прихваща и обработва изключението
3. `finally` – блок, който се изпълнява винаги
4. `throws` – декларира, че метод може да хвърли изключение
5. `throw` – ръчно хвърля изключение

---

## Пример за `try-catch`

```java
try {
    Scanner sc = new Scanner(System.in);
    int num = sc.nextInt(); // възможен InputMismatchException
    System.out.println(10 / num); // възможен ArithmeticException
} catch (InputMismatchException e) {
    System.out.println("Not an integer.");
} catch (ArithmeticException e) {
    System.out.println("Division by zero.");
} catch (Exception e) { // най-общо
    e.printStackTrace();
}
```

! `catch` блоковете трябва да са подредени от по-конкретен към по-общ.

---

## `finally` блок

```java
try {
    int[] arr = new int[3];
    System.out.println(arr[5]);
} catch (ArrayIndexOutOfBoundsException e) {
    System.out.println("Invalid index.");
} finally {
    System.out.println("This always executes.");
}
```

! `finally` се изпълнява винаги, независимо дали е хвърлено изключение.

---

## `throws` и `throw`

### throws (деклариране)

```java
public static void test() throws IOException {
    FileReader fr = new FileReader("file.txt");
}
```

Методът прехвърля обработката на извикващия.

### throw (ръчно хвърляне)

```java
public static void check(int price) {
    if (price < 0) {
        throw new IllegalArgumentException("Negative price");
    }
}
```

! Ако хвърляме Checked Exception, методът трябва да го декларира с `throws`.

---

## Собствени (Custom) Exceptions

```java
class PriceErrorException extends Exception {
    @Override
    public String getMessage() {
        return "Invalid price!";
    }
}

public static int readPrice() throws PriceErrorException {
    Scanner sc = new Scanner(System.in);
    int p = sc.nextInt();
    if (p < 100 || p > 500) {
        throw new PriceErrorException();
    }
    return p;
}
```

! Custom Exception се създава чрез наследяване на `Exception` или `RuntimeException`.

---

## Обобщение

* Изключенията предотвратяват срив на програмата и позволяват контролирана обработка на грешки.
* Checked → задължително обработване; Unchecked → по избор.
* `try-catch` прихваща; `finally` се изпълнява винаги.
* `throws` декларира, `throw` хвърля.
* Можем да дефинираме собствени изключения за по-добра яснота на кода.
